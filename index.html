<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Public Health Research Interview Question Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  :root{--b:#0f172a;--m:#475569;--l:#64748b;--bd:#cbd5e1;--p:#f8fafc;--accent:#0f172a}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--b);margin:0;background:#fff}
  .wrap{max-width:1040px;margin:24px auto;padding:0 16px}
  h1{font-size:1.7rem;margin:.2rem 0 .6rem}
  h2{margin:.2rem 0 .35rem}
  .panel{background:#fff;border:1px solid #e2e8f0;border-radius:12px;padding:16px;margin:12px 0}
  .soft{background:var(--p)}
  .muted{color:var(--m)}
  .hint{color:var(--l);margin:.25rem 0 .5rem}
  textarea,input[type=text]{width:100%;border:1px solid var(--bd);border-radius:10px;padding:10px}
  textarea{resize:vertical}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid var(--bd);background:#fff;border-radius:999px;padding:8px 12px;font-size:.92rem;cursor:pointer;outline:none}
  .chip[aria-pressed="true"],.chip:focus{background:var(--accent);color:#fff;border-color:var(--accent)}
  .chip:focus{box-shadow:0 0 0 3px #bae6fd}
  .summary{border:1px dashed var(--bd);background:#fff;border-radius:12px;padding:12px}
  .exbox{border:1px dashed var(--bd);background:#fff;border-radius:12px;padding:12px}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .btn{border:1px solid var(--bd);background:#fff;border-radius:10px;padding:10px 12px;font-size:.95rem;cursor:pointer;outline:none}
  .btn.primary{background:#0f172a;color:#fff;border-color:#0f172a}
  .btn:focus{box-shadow:0 0 0 3px #bae6fd}
  .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:10px}
  .kicker{font-size:.75rem;letter-spacing:.06em;text-transform:uppercase;color:#64748b}
  table{width:100%;border-collapse:collapse;font-size:.95rem}
  th,td{border:1px solid #e2e8f0;padding:8px;text-align:left;vertical-align:top}
  thead th{background:#f1f5f9}
  details>summary{cursor:pointer;font-weight:600}
  .tiny{font-size:.82rem}
  .label{font-weight:600}
  .error-highlight{border-color:#dc2626!important;background:#fef2f2!important}
  .status-message{background:#e0f2fe;color:#0f172a;padding:8px 16px;border-radius:8px;text-align:center;font-size:.97rem;margin:10px 0;display:none}
  @media (max-width:600px){
    .wrap{padding:0 4px}
    .panel,.soft{padding:8px}
    .chips{gap:4px}
    .btn{padding:10px 6px;font-size:.95rem}
    .row{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="wrap">
  <!-- Status Message -->
  <div id="statusMessage" class="status-message" aria-live="polite"></div>
  <!-- Intro -->
  <header class="panel soft">
    <h1>Public Health Research Interview Question Builder</h1>
    <p class="muted">This tool guides you in constructing a clear, neutral, open-ended <strong>qualitative research interview question</strong> for public health. You’ll pick a <em>focus</em>, a <em>question role</em>, a <em>stem</em>, draft your question, and finish with a <em>quality check</em>. You can also add a follow-up to deepen short or vague answers.</p>
    <p class="hint" style="margin-top:.5rem">This is for qualitative interviews (not surveys/job interviews). Use for research with participants in public health or social sciences.</p>
  </header>

  <!-- Step 1: Types reference -->
  <section class="panel" id="step1">
    <div class="kicker">Step 1</div>
    <h2>Types of Research Interview Questions</h2>
    <p class="hint">Use this guide before drafting. Prefer open-ended and probing; avoid leading & double-barreled prompts. All examples are public health interview questions.</p>
    <table aria-label="Types of interview questions">
      <thead>
        <tr><th>Type</th><th>Description</th><th>Public health example</th><th>Use</th></tr>
      </thead>
      <tbody>
        <tr><td>Open-ended</td><td>Encourages depth & story.</td><td>“Can you describe how access to transportation affects your ability to get to clinic appointments?”</td><td>Yes</td></tr>
        <tr><td>Probing</td><td>Follows up for detail.</td><td>“Can you say more about that?” / “What happened next?”</td><td>Yes</td></tr>
        <tr><td>Demographic</td><td>Background info.</td><td>“What is your age range?” / “How would you describe your housing situation?”</td><td>Yes, briefly</td></tr>
        <tr><td>Closed</td><td>Yes/No only.</td><td>“Do you have health insurance?”</td><td>Use sparingly</td></tr>
        <tr><td>Leading</td><td>Suggests a “right” answer.</td><td>“Wouldn’t you agree that vaping is obviously harmful?”</td><td>No</td></tr>
        <tr><td>Double-barreled</td><td>Asks two things at once.</td><td>“How do cost <em>and</em> transportation affect your ability to attend appointments?”</td><td>Split it</td></tr>
        <tr><td>Hypothetical</td><td>Imagined scenario.</td><td>“If your clinic moved farther away, how would you handle visits?”</td><td>Use cautiously</td></tr>
      </tbody>
    </table>
    <div class="toolbar">
      <button class="btn primary" id="step1Next" aria-label="Go to next step">Next</button>
    </div>
  </section>

  <!-- Step 2: Topic & Focus -->
  <section class="panel soft" id="step2" style="display:none;">
    <div class="kicker">Step 2</div>
    <h2>Your Public Health Topic & Choose a Focus</h2>
    <p class="hint">Describe your research topic or question in 1–2 sentences, then select ONE focus lens. This helps narrow your interview question.</p>
    <label class="label tiny" for="topic">Public health topic or guiding research question <span id="topicReq" style="color:#dc2626;display:none;">(required)</span></label>
    <textarea id="topic" rows="3" placeholder="e.g., Barriers to accessing campus mental health services for first-generation students"></textarea>
    <div style="height:8px"></div>
    <div class="label tiny">Focus (choose one) <span id="focusReq" style="color:#dc2626;display:none;">(required)</span></div>
    <div id="focusChips" class="chips" role="tablist" aria-label="Focus"></div>
    <p class="hint" style="margin-top:.5rem">Options: Background/Context · Experience · Impact · Barriers · Supports · Solutions/Recommendations</p>
    <div class="toolbar">
      <button class="btn" id="step2Prev" aria-label="Back to previous step">Back</button>
      <button class="btn primary" id="step2Next" aria-label="Go to next step">Next</button>
    </div>
  </section>

  <!-- Step 3: Question role -->
  <section class="panel" id="step3" style="display:none;">
    <div class="kicker">Step 3</div>
    <h2>Identify Your Interview Question Role</h2>
    <p class="hint">Pick one. The definition and a public-health example will appear below.</p>
    <div id="roleChips" class="chips" role="tablist" aria-label="Question role"></div>
    <div class="summary" style="margin-top:10px">
      <div class="kicker" id="roleLabel">Role</div>
      <div id="roleDef" class="muted" style="margin-top:4px">Select a role to see its purpose.</div>
      <div class="kicker" style="margin-top:10px">Example</div>
      <div id="roleEx" style="font-weight:600; margin-top:4px">—</div>
      <span id="roleReq" style="color:#dc2626;display:none;">(required)</span>
    </div>
    <div class="toolbar">
      <button class="btn" id="step3Prev" aria-label="Back to previous step">Back</button>
      <button class="btn primary" id="step3Next" aria-label="Go to next step">Next</button>
    </div>
  </section>

  <!-- Step 4: Stem + auto-example + rewrite -->
  <section class="panel soft" id="step4" style="display:none;">
    <div class="kicker">Step 4</div>
    <h2>Pick a Stem → See an Example → Write Your Interview Question</h2>
    <p class="hint">Click a stem, add your own, then rewrite the example as your final, single-focus, neutral research interview question.</p>
    <div class="label tiny">Stem (click to select or type your own) <span id="stemReq" style="color:#dc2626;display:none;">(required)</span></div>
    <div id="stemChips" class="chips" aria-label="Stem choices"></div>
    <input id="stem" type="text" placeholder="e.g., In what ways…" aria-label="Stem" autocomplete="off">
    <div style="height:12px"></div>
    <div class="exbox">
      <div class="kicker">Auto-example (based on your stem)</div>
      <div id="stemExample" style="font-weight:600; margin-top:4px;">In what ways does ____ affect ____?</div>
    </div>
    <label class="label tiny" for="rewrite">Your research interview question (rewrite the example in your own words) <span id="rewriteReq" style="color:#dc2626;display:none;">(required)</span></label>
    <input id="rewrite" type="text" placeholder="Type your final public-health research interview question here…" aria-label="Final interview question">
    <label class="label tiny" for="follow">Optional follow-up (to deepen short answers)</label>
    <input id="follow" type="text" placeholder="e.g., Can you give a specific example? / What happened next? / How did that affect you?">
    <div class="toolbar">
      <button class="btn" id="step4Prev" aria-label="Back to previous step">Back</button>
      <button class="btn primary" id="step4Next" aria-label="Go to next step">Next</button>
    </div>
  </section>

  <!-- Step 5: Selections summary + live preview -->
  <section class="panel" id="step5" style="display:none;">
    <div class="kicker">Step 5</div>
    <h2>Your Selections & Live Preview</h2>
    <div class="summary tiny" id="selectionsBox" style="white-space:pre-wrap"></div>
    <div class="exbox" style="margin-top:10px; white-space:pre-wrap" id="previewBox"></div>
    <div class="toolbar">
      <button class="btn primary" id="copyBtn" aria-label="Copy summary to clipboard">Copy</button>
      <button class="btn" onclick="window.print()" aria-label="Print summary">Print</button>
      <button class="btn" id="resetBtn" aria-label="Reset form">Reset</button>
    </div>
    <div class="toolbar" style="margin-top:6px;">
      <button class="btn" id="step5Prev" aria-label="Back to previous step">Back</button>
      <button class="btn primary" id="step5Next" aria-label="Go to next step">Next</button>
    </div>
  </section>

  <!-- Step 6: Quality check -->
  <section class="panel soft" id="step6" style="display:none;">
    <div class="kicker">Step 6</div>
    <h2>Quality Check (typed reflection; optional checkboxes)</h2>
    <p class="hint">Write 1 sentence for each item. (Checkboxes are optional.)</p>
    <div class="row">
      <div>
        <label class="tiny"><input type="checkbox" id="c_ties"> Tied to topic</label>
        <textarea id="r_ties" rows="2" placeholder="How is your question tied to the public-health topic?"></textarea>
      </div>
      <div>
        <label class="tiny"><input type="checkbox" id="c_open"> Open-ended</label>
        <textarea id="r_open" rows="2" placeholder="Why can’t this be answered with yes/no?"></textarea>
      </div>
      <div>
        <label class="tiny"><input type="checkbox" id="c_neutral"> Neutral</label>
        <textarea id="r_neutral" rows="2" placeholder="What assumptions or judgments did you remove?"></textarea>
      </div>
      <div>
        <label class="tiny"><input type="checkbox" id="c_clear"> Clear wording</label>
        <textarea id="r_clear" rows="2" placeholder="Which jargon or acronyms did you avoid?"></textarea>
      </div>
      <div>
        <label class="tiny"><input type="checkbox" id="c_detail"> Invites detail</label>
        <textarea id="r_detail" rows="2" placeholder="How does it invite stories, sequences, or examples?"></textarea>
      </div>
    </div>
    <div class="toolbar">
      <button class="btn" id="step6Prev" aria-label="Back to previous step">Back</button>
      <button class="btn primary" id="step6Next" aria-label="Finish">Finish</button>
    </div>
  </section>

  <!-- Final: Interview roles reference -->
  <section class="panel soft" id="step7" style="display:none;">
    <h2>All Done!</h2>
    <div class="exbox" id="finalPreview" style="white-space:pre-wrap"></div>
    <div class="toolbar">
      <button class="btn primary" id="restartBtn" aria-label="Restart builder">Start Over</button>
    </div>
    <details class="panel" style="margin-top:16px;">
      <summary>Interview roles (quick reference)</summary>
      <ul class="tiny">
        <li><strong>Introductory</strong> — warm-up to ease into the topic. <em>Example:</em> “Can you tell me about alcohol use among your peers?”</li>
        <li><strong>Core</strong> — heart of the research. <em>Example:</em> “How do you think alcohol affects stress?”</li>
        <li><strong>Follow-Up</strong> — add depth/clarification. <em>Example:</em> “Can you give an example?”</li>
        <li><strong>Closing</strong> — invite reflection/advice. <em>Example:</em> “What advice would you give a friend about alcohol and mental health?”</li>
      </ul>
    </details>
    <p class="muted" style="text-align:center; font-size:.8rem; margin-top:10px">
      Your entries save in this browser (local only).
    </p>
  </section>
</div>
<script>
(function(){
  // ---- Data ----
  const FOCUS = [
    { id:"background", label:"Background / Context" },
    { id:"experience", label:"Experience" },
    { id:"impact", label:"Impact" },
    { id:"barriers", label:"Barriers" },
    { id:"supports", label:"Supports" },
    { id:"solutions", label:"Solutions / Recommendations" }
  ];
  const ROLES = [
    { id:"intro",   label:"Introductory", def:"Warm-up to ease into the topic and establish context.", ex:"Can you tell me about alcohol use among your peers?" },
    { id:"core",    label:"Core", def:"Heart of the research; targets your main concept.", ex:"How do you think alcohol affects stress?" },
    { id:"follow",  label:"Follow-Up", def:"Adds depth or clarification after a short/unclear answer.", ex:"Can you give an example?" },
    { id:"closing", label:"Closing", def:"Invites reflection, advice, or takeaway at the end.", ex:"What advice would you give a friend about alcohol and mental health?" }
  ];
  const STEMS = [
    "How do you…",
    "What happens when…",
    "In what ways…",
    "Can you walk me through…",
    "Tell me about a time when…",
    "What would you change about…",
    "What matters most to you about…"
  ];
  const STEM_PATTERNS = {
    "How do you…": "How do you ____ when ____?",
    "What happens when…": "What happens when ____? Can you give an example?",
    "In what ways…": "In what ways does ____ affect ____?",
    "Can you walk me through…": "Can you walk me through ____ from start to finish?",
    "Tell me about a time when…": "Tell me about a time when ____. What happened?",
    "What would you change about…": "What would you change about ____, and why?",
    "What matters most to you about…": "What matters most to you about ____?"
  };
  // ---- Elements ----
  const $ = (id)=>document.getElementById(id);
  const topic = $("topic");
  const roleChips = $("roleChips");
  const roleLabel = $("roleLabel");
  const roleDef = $("roleDef");
  const roleEx = $("roleEx");
  const stemChips = $("stemChips");
  const stem = $("stem");
  const stemExample = $("stemExample");
  const rewrite = $("rewrite");
  const follow = $("follow");
  const selectionsBox = $("selectionsBox");
  const preview = $("previewBox");
  const statusMsg = $("statusMessage");
  // quality
  const qIds = ["r_ties","r_open","r_neutral","r_clear","r_detail","c_ties","c_open","c_neutral","c_clear","c_detail"];
  const qEls = Object.fromEntries(qIds.map(id=>[id,$(id)]));
  // state
  let selectedRole = null;
  let selectedStem = "";
  let selectedFocus = null;
  let currentStep = 1;
  // ---- Build focus chips ----
  FOCUS.forEach((f,idx)=>{
    const btn = document.createElement("button");
    btn.className = "chip";
    btn.type = "button";
    btn.setAttribute("role","tab");
    btn.setAttribute("aria-pressed","false");
    btn.setAttribute("tabindex","0");
    btn.textContent = f.label;
    btn.onclick = ()=>{
      [...$("focusChips").querySelectorAll(".chip")].forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      selectedFocus = f;
      save(); buildSelections(); buildPreview(); postHeight();
    };
    btn.onkeydown = e => { if(e.key==="Enter"||e.key===" "){btn.click();} };
    $("focusChips").appendChild(btn);
  });
  // ---- Build role chips ----
  ROLES.forEach(r=>{
    const btn = document.createElement("button");
    btn.className = "chip";
    btn.type = "button";
    btn.setAttribute("role","tab");
    btn.setAttribute("aria-pressed","false");
    btn.setAttribute("tabindex","0");
    btn.textContent = r.label;
    btn.onclick = ()=>{
      [...$("roleChips").querySelectorAll(".chip")].forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      selectedRole = r;
      $("roleLabel").textContent = r.label + " question";
      $("roleDef").textContent = r.def;
      $("roleEx").textContent = r.ex;
      save(); buildSelections(); buildPreview(); postHeight();
    };
    btn.onkeydown = e => { if(e.key==="Enter"||e.key===" "){btn.click();} };
    $("roleChips").appendChild(btn);
  });
  // ---- Build stem chips, with "Add your own" ----
  STEMS.forEach(s=>{
    const btn = document.createElement("button");
    btn.className = "chip";
    btn.type = "button";
    btn.setAttribute("role","tab");
    btn.setAttribute("aria-pressed","false");
    btn.setAttribute("tabindex","0");
    btn.textContent = s;
    btn.onclick = ()=>{
      [...$("stemChips").querySelectorAll(".chip")].forEach(b=>b.setAttribute("aria-pressed","false"));
      btn.setAttribute("aria-pressed","true");
      selectedStem = s;
      stem.value = s;
      buildExample(); save(); buildSelections(); buildPreview(); postHeight();
    };
    btn.onkeydown = e => { if(e.key==="Enter"||e.key===" "){btn.click();} };
    $("stemChips").appendChild(btn);
  });
  // Add "Add your own" chip
  const customChip = document.createElement("button");
  customChip.className = "chip";
  customChip.type = "button";
  customChip.setAttribute("role","tab");
  customChip.setAttribute("aria-pressed","false");
  customChip.setAttribute("tabindex","0");
  customChip.textContent = "Add your own…";
  customChip.onclick = ()=>{
    [...$("stemChips").querySelectorAll(".chip")].forEach(b=>b.setAttribute("aria-pressed","false"));
    customChip.setAttribute("aria-pressed","true");
    stem.focus();
  };
  customChip.onkeydown = e => { if(e.key==="Enter"||e.key===" "){customChip.click();} };
  $("stemChips").appendChild(customChip);
  // ---- Builders ----
  function buildExample(){
    const s = (stem.value||"").trim();
    $("stemExample").textContent = STEM_PATTERNS[s] || (s ? s+" …" : "In what ways does ____ affect ____?");
  }
  function buildSelections(){
    const lines = [];
    lines.push("Your selections");
    lines.push("• Focus: " + (selectedFocus ? selectedFocus.label : "—"));
    lines.push("• Role: " + (selectedRole ? selectedRole.label : "—"));
    lines.push("• Stem: " + ((stem.value||"").trim() || "—"));
    $("selectionsBox").textContent = lines.join("\n");
  }
  function buildPreview(){
    const lines = [];
    lines.push("Topic: " + (topic.value.trim() || "—"));
    lines.push("Focus: " + (selectedFocus ? selectedFocus.label : "—"));
    lines.push("Role: " + (selectedRole ? selectedRole.label : "—"));
    lines.push("Stem: " + ((stem.value||"").trim() || "—"));
    lines.push("Question: " + (rewrite.value.trim() || ((stem.value.trim()? stem.value.trim()+" …" : "—"))));
    lines.push("Follow-up: " + (follow.value.trim() || "—"));
    lines.push("");
    lines.push("Quality reflections:");
    lines.push("• Tied to topic: " + (qEls.r_ties.value.trim() || "—"));
    lines.push("• Open-ended: " + (qEls.r_open.value.trim() || "—"));
    lines.push("• Neutral: " + (qEls.r_neutral.value.trim() || "—"));
    lines.push("• Clear wording: " + (qEls.r_clear.value.trim() || "—"));
    lines.push("• Invites detail: " + (qEls.r_detail.value.trim() || "—"));
    $("previewBox").textContent = lines.join("\n");
    $("finalPreview").textContent = lines.join("\n");
  }
  // ---- Copy/Reset ----
  $("copyBtn").onclick = async ()=>{
    try{
      await navigator.clipboard.writeText($("previewBox").textContent);
      showStatus("Copied to clipboard.");
    }
    catch{
      window.prompt("Copy the text below:", $("previewBox").textContent);
    }
  };
  $("resetBtn").onclick = ()=>{
    if(!confirm("Clear all fields?")) return;
    topic.value = ""; stem.value = ""; rewrite.value = ""; follow.value = "";
    selectedFocus = null; selectedRole = null; selectedStem = "";
    [...$("focusChips").querySelectorAll(".chip")].forEach(b=>b.setAttribute("aria-pressed","false"));
    [...$("roleChips").querySelectorAll(".chip")].forEach(b=>b.setAttribute("aria-pressed","false"));
    [...$("stemChips").querySelectorAll(".chip")].forEach(b=>b.setAttribute("aria-pressed","false"));
    $("roleLabel").textContent = "Role";
    $("roleDef").textContent = "Select a role to see its purpose.";
    $("roleEx").textContent = "—";
    Object.values(qEls).forEach(el=>{
      if(el.type==="checkbox") el.checked=false; else el.value="";
    });
    save(); buildExample(); buildSelections(); buildPreview(); postHeight();
    goToStep(1);
  };
  $("restartBtn").onclick = ()=>{
    $("resetBtn").onclick();
  };
  // ---- Autosave ----
  const KEY="ph-iqb-v1";
  function save(){
    const s = {
      topic: topic.value, stem: stem.value, rewrite: rewrite.value, follow: follow.value,
      role: selectedRole? selectedRole.id : null,
      focus: selectedFocus? selectedFocus.id : null,
      q: {
        r_ties:qEls.r_ties.value, r_open:qEls.r_open.value, r_neutral:qEls.r_neutral.value,
        r_clear:qEls.r_clear.value, r_detail:qEls.r_detail.value,
        c_ties:qEls.c_ties.checked, c_open:qEls.c_open.checked, c_neutral:qEls.c_neutral.checked,
        c_clear:qEls.c_clear.checked, c_detail:qEls.c_detail.checked
      }
    };
    localStorage.setItem(KEY, JSON.stringify(s));
  }
  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return;
      const s = JSON.parse(raw);
      topic.value = s.topic||"";
      stem.value = s.stem||"";
      rewrite.value = s.rewrite||"";
      follow.value = s.follow||"";
      if(s.focus){
        const idxF = FOCUS.findIndex(f=>f.id===s.focus);
        if(idxF>=0) $("focusChips").children[idxF].click();
      }
      if(s.role){
        const idxR = ROLES.findIndex(r=>r.id===s.role);
        if(idxR>=0) $("roleChips").children[idxR].click();
      }
      if(s.q){
        qEls.r_ties.value = s.q.r_ties||"";
        qEls.r_open.value = s.q.r_open||"";
        qEls.r_neutral.value = s.q.r_neutral||"";
        qEls.r_clear.value = s.q.r_clear||"";
        qEls.r_detail.value = s.q.r_detail||"";
        qEls.c_ties.checked = !!s.q.c_ties;
        qEls.c_open.checked = !!s.q.c_open;
        qEls.c_neutral.checked = !!s.q.c_neutral;
        qEls.c_clear.checked = !!s.q.c_clear;
        qEls.c_detail.checked = !!s.q.c_detail;
      }
    }catch(e){}
  }
  // ---- Events ----
  document.addEventListener("input", ()=>{ save(); buildExample(); buildSelections(); buildPreview(); });
  document.addEventListener("change", ()=>{ save(); buildExample(); buildSelections(); buildPreview(); });
  // ---- Step Navigation & Validation ----
  function goToStep(step){
    for(let i=1;i<=7;i++) $("step"+i)?.style&&( $("step"+i).style.display = (i===step?"":"none") );
    currentStep = step;
    window.scrollTo({top:0,behavior:"smooth"});
  }
  function showStatus(msg){
    statusMsg.textContent = msg;
    statusMsg.style.display = "block";
    setTimeout(()=>{statusMsg.style.display="none";},2200);
  }
  // Validate required fields for Steps 2-4
  function validateStep2(){
    let ok=true;
    if(!topic.value.trim()){
      topic.classList.add("error-highlight");
      $("topicReq").style.display="inline";
      ok=false; topic.focus();
    }else{
      topic.classList.remove("error-highlight");
      $("topicReq").style.display="none";
    }
    if(!selectedFocus){
      $("focusChips").classList.add("error-highlight");
      $("focusReq").style.display="inline";
      ok=false; $("focusChips").scrollIntoView({behavior:"smooth"});
    }else{
      $("focusChips").classList.remove("error-highlight");
      $("focusReq").style.display="none";
    }
    return ok;
  }
  function validateStep3(){
    let ok=true;
    if(!selectedRole){
      $("roleChips").classList.add("error-highlight");
      $("roleReq").style.display="inline";
      ok=false; $("roleChips").scrollIntoView({behavior:"smooth"});
    }else{
      $("roleChips").classList.remove("error-highlight");
      $("roleReq").style.display="none";
    }
    return ok;
  }
  function validateStep4(){
    let ok=true;
    if(!stem.value.trim()){
      stem.classList.add("error-highlight");
      $("stemReq").style.display="inline";
      ok=false; stem.focus();
    }else{
      stem.classList.remove("error-highlight");
      $("stemReq").style.display="none";
    }
    if(!rewrite.value.trim()){
      rewrite.classList.add("error-highlight");
      $("rewriteReq").style.display="inline";
      ok=false; rewrite.focus();
    }else{
      rewrite.classList.remove("error-highlight");
      $("rewriteReq").style.display="none";
    }
    return ok;
  }
  // Step buttons
  $("step1Next").onclick = ()=>{ goToStep(2); };
  $("step2Prev").onclick = ()=>{ goToStep(1); };
  $("step2Next").onclick = ()=>{
    if(validateStep2()) goToStep(3); else showStatus("Complete required fields before continuing.");
  };
  $("step3Prev").onclick = ()=>{ goToStep(2); };
  $("step3Next").onclick = ()=>{
    if(validateStep3()) goToStep(4); else showStatus("Select a role before continuing.");
  };
  $("step4Prev").onclick = ()=>{ goToStep(3); };
  $("step4Next").onclick = ()=>{
    if(validateStep4()) goToStep(5); else showStatus("Complete required fields before continuing.");
  };
  $("step5Prev").onclick = ()=>{ goToStep(4); };
  $("step5Next").onclick = ()=>{ goToStep(6); };
  $("step6Prev").onclick = ()=>{ goToStep(5); };
  $("step6Next").onclick = ()=>{ goToStep(7); };
  // ---- Init ----
  load(); buildExample(); buildSelections(); buildPreview(); postHeight();
  goToStep(1);
  // ---- Iframe auto-height messaging (optional; harmless if standalone) ----
  function postHeight(){
    if(!window.parent || window.parent === window) return;
    const h = document.documentElement.scrollHeight;
    window.parent.postMessage({type:"iqb-height", height:h}, "*");
  }
  new ResizeObserver(postHeight).observe(document.documentElement);
})();
</script>
</body>
</html>
